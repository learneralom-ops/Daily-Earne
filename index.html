
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Earning - Earn Money Online</title>
    <meta name="description" content="Earn money daily by completing simple tasks, watching ads, and inviting friends. Start earning now!">
    <meta name="keywords" content="earn money online, daily earning, watch ads earn money, make money online">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Mone Tag Ads SDK -->
    <script src='//libtl.com/sdk.js' data-zone='8954258' data-sdk='show_8954258'></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'primary': '#3B82F6',
                        'secondary': '#10B981',
                        'accent': '#F59E0B',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'countdown-pulse': 'countdownPulse 1s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: 0, transform: 'translateY(10px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' }
                        },
                        countdownPulse: {
                            '0%, 100%': { transform: 'scale(1)', opacity: 1 },
                            '50%': { transform: 'scale(1.05)', opacity: 0.8 }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f6f8ff 0%, #f0f4ff 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.dark {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #e2e8f0;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        }
        
        .dark .glass-card {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .gradient-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .notification-slide {
            animation: slideIn 0.3s ease-out;
        }
        
        .taka-symbol {
            font-family: Arial, sans-serif;
            font-weight: bold;
        }
        
        .profile-pic {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border: 3px solid #667eea;
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .file-input-container input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        /* Ad loading overlay styles */
        .ad-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .ad-progress-bar {
            width: 80%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .ad-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .ad-step-indicator {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .ad-step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .ad-step.active {
            background: #667eea;
            transform: scale(1.1);
        }
        
        .ad-step.completed {
            background: #10B981;
        }
        
        /* Countdown styles */
        .countdown-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }
        
        .countdown-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
            animation: countdown-pulse 1s ease-in-out infinite;
        }
        
        .countdown-number {
            font-size: 48px;
            font-weight: bold;
            color: white;
        }
        
        .countdown-text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: white;
        }
        
        .countdown-subtext {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
        }
        
        /* Celebration styles */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.5s ease-out;
        }
        
        .celebration-icon {
            font-size: 80px;
            color: #F59E0B;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .celebration-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #F59E0B, #F97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .celebration-amount {
            font-size: 48px;
            font-weight: bold;
            color: #10B981;
            margin-bottom: 20px;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #F59E0B;
            border-radius: 50%;
            animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .celebration-message {
            font-size: 18px;
            text-align: center;
            max-width: 300px;
            margin-bottom: 30px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* Video ad specific styles */
        .video-ad-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }
        
        .video-icon {
            font-size: 60px;
            color: #EF4444;
            margin-bottom: 20px;
        }
        
        .video-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
        }
        
        .video-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
            max-width: 300px;
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9998;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-container {
            background: white;
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .dark .modal-container {
            background: #1e293b;
            color: white;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #1e293b;
        }

        .dark .modal-title {
            color: white;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }

        .modal-close:hover {
            color: #ef4444;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 dark:text-gray-100">
    <div id="app" class="min-h-screen pb-20 max-w-md mx-auto">
        <!-- Header -->
        <header class="sticky top-0 z-40 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-700 py-4 px-6 shadow-sm">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full gradient-primary flex items-center justify-center">
                        <i class="fas fa-coins text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800 dark:text-white">Daily Earning</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-300" id="pageTitle">Earn money online</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="themeToggle" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                        <i class="fas fa-moon text-gray-600 dark:text-yellow-400"></i>
                    </button>
                    <button id="logoutBtn" class="w-10 h-10 rounded-full bg-red-100 dark:bg-red-800 flex items-center justify-center hover:bg-red-200 dark:hover:bg-red-700 transition hidden">
                        <i class="fas fa-sign-out-alt text-red-600 dark:text-red-300"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Auth Pages -->
        <div id="authContainer" class="px-4 py-6">
            <!-- Login Page -->
            <div id="loginPage" class="page active">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 rounded-full gradient-primary flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-coins text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Welcome Back!</h2>
                    <p class="text-gray-600 dark:text-gray-300 mt-2">Login to your account</p>
                </div>
                
                <div class="glass-card rounded-2xl p-6">
                    <form id="loginForm">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email or Phone Number</label>
                                <input type="text" id="loginEmailPhone" required 
                                       class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                       placeholder="Enter email or phone number">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password</label>
                                <div class="relative">
                                    <input type="password" id="loginPassword" required 
                                           class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                           placeholder="Enter password">
                                    <button type="button" id="toggleLoginPassword" class="absolute right-3 top-3 text-gray-500">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <label class="flex items-center">
                                    <input type="checkbox" id="rememberMe" 
                                       class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                    <span class="ml-2 text-sm text-gray-600 dark:text-gray-300">Remember me</span>
                                </label>
                                <a href="#" id="forgotPassword" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">Forgot password?</a>
                            </div>
                            
                            <button type="submit" id="loginBtn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 rounded-xl hover:opacity-90 transition flex items-center justify-center">
                                <span>Login</span>
                                <div id="loginSpinner" class="loader ml-2 hidden" style="width: 20px; height: 20px;"></div>
                            </button>
                            
                            <div class="text-center">
                                <p class="text-gray-600 dark:text-gray-300">Don't have an account? 
                                    <button id="showSignupBtn" class="text-blue-600 dark:text-blue-400 font-medium hover:underline">Sign Up</button>
                                </p>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="mt-6 text-center">
                    <p class="text-xs text-gray-500 dark:text-gray-400">By continuing, you agree to our 
                        <a href="#" class="text-blue-600 dark:text-blue-400">Terms of Service</a> and 
                        <a href="#" class="text-blue-600 dark:text-blue-400">Privacy Policy</a>
                    </p>
                </div>
            </div>

            <!-- Signup Page -->
            <div id="signupPage" class="page">
                <div class="flex items-center mb-6">
                    <button id="backToLogin" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mr-3 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                        <i class="fas fa-arrow-left text-gray-600 dark:text-gray-300"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Create Account</h2>
                </div>
                
                <div class="glass-card rounded-2xl p-6">
                    <form id="signupForm">
                        <div class="space-y-4">
                            <!-- Profile Picture Upload -->
                            <div class="text-center mb-4">
                                <div class="relative inline-block">
                                    <img id="profilePreview" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" 
                                         alt="Profile" class="profile-pic rounded-full mx-auto mb-3">
                                    <div class="file-input-container">
                                        <button type="button" class="absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition">
                                            <i class="fas fa-camera"></i>
                                        </button>
                                        <input type="file" id="profilePicture" accept="image/*" class="cursor-pointer">
                                    </div>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-300">Upload profile picture</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name</label>
                                <input type="text" id="fullName" required 
                                       class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                       placeholder="Enter your full name">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Address</label>
                                <input type="email" id="signupEmail" required 
                                       class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                       placeholder="Enter your email">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Phone Number</label>
                                <input type="tel" id="phoneNumber" 
                                       class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                       placeholder="Enter phone number (optional)">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password</label>
                                <div class="relative">
                                    <input type="password" id="signupPassword" required 
                                           class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                           placeholder="Create password (min. 6 characters)">
                                    <button type="button" id="toggleSignupPassword" class="absolute right-3 top-3 text-gray-500">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Must be at least 6 characters</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Confirm Password</label>
                                <div class="relative">
                                    <input type="password" id="confirmPassword" required 
                                           class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                           placeholder="Confirm your password">
                                    <button type="button" id="toggleConfirmPassword" class="absolute right-3 top-3 text-gray-500">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Referral Code Input -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Referral Code (Optional)</label>
                                <input type="text" id="referralCodeInput" 
                                       class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                       placeholder="Enter referral code if you have one">
                            </div>
                            
                            <div class="flex items-start">
                                <input type="checkbox" id="agreeTerms" required 
                                       class="w-4 h-4 mt-1 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label for="agreeTerms" class="ml-2 text-sm text-gray-600 dark:text-gray-300">
                                    I agree to the <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline">Terms of Service</a> and <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline">Privacy Policy</a>
                                </label>
                            </div>
                            
                            <button type="submit" id="signupBtn" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 rounded-xl hover:opacity-90 transition flex items-center justify-center">
                                <span>Create Account</span>
                                <div id="signupSpinner" class="loader ml-2 hidden" style="width: 20px; height: 20px;"></div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main id="mainContainer" class="px-4 py-6 hidden">
            <!-- Home Page -->
            <div id="homePage" class="page active">
                <!-- Balance Card -->
                <div class="glass-card rounded-2xl p-6 mb-6 gradient-primary text-white shadow-xl">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <p class="text-sm opacity-90">Total Balance</p>
                            <h2 id="balanceAmount" class="text-4xl font-bold mt-1">
                                <span class="taka-symbol text-3xl">৳</span> <span id="currentBalance">0</span>
                            </h2>
                        </div>
                        <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center">
                            <i class="fas fa-wallet text-2xl"></i>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3 mb-6">
                        <button id="depositBtn" class="flex-1 bg-white text-blue-600 font-semibold py-3 rounded-xl hover:bg-gray-50 transition active:scale-95">
                            <i class="fas fa-plus-circle mr-2"></i> Deposit
                        </button>
                        <button id="withdrawBtn" class="flex-1 bg-white/20 text-white font-semibold py-3 rounded-xl hover:bg-white/30 transition active:scale-95">
                            <i class="fas fa-dollar-sign mr-2"></i> Withdraw
                        </button>
                    </div>
                </div>
                
                <p>Daily Ads Count
                 <span class="text-xs text-gray-500 dark:text-gray-400 mt-1" id="dailyAdsCounter">(0/15)</span> </p>
                
                <!-- Quick Actions -->
                <div class="grid grid-cols-4 gap-3 mb-6">
                    <button class="quick-action" data-action="watch-ads">
                        <div class="w-16 h-16 rounded-xl bg-blue-100 dark:bg-blue-900 flex items-center justify-center mb-2">
                            <i class="fas fa-ad text-blue-600 dark:text-blue-300 text-xl"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-800 dark:text-gray-200">Watch Ads</span>
                    </button>
                    
                    <button class="quick-action" data-action="watch-videos">
                        <div class="w-16 h-16 rounded-xl bg-red-100 dark:bg-red-900 flex items-center justify-center mb-2">
                            <i class="fas fa-play-circle text-red-600 dark:text-red-300 text-xl"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-800 dark:text-gray-200">Ads Videos</span>
                    </button>
                    
                    <button class="quick-action" data-action="daily-bonus">
                        <div class="w-16 h-16 rounded-xl bg-green-100 dark:bg-green-900 flex items-center justify-center mb-2">
                            <i class="fas fa-gift text-green-600 dark:text-green-300 text-xl"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-800 dark:text-gray-200">Daily Bonus</span>
                    </button>
                    
                    <button class="quick-action" data-action="invite-friends">
                        <div class="w-16 h-16 rounded-xl bg-purple-100 dark:bg-purple-900 flex items-center justify-center mb-2">
                            <i class="fas fa-user-plus text-purple-600 dark:text-purple-300 text-xl"></i>
                        </div>
                        <span class="text-xs font-medium text-gray-800 dark:text-gray-200">Invite</span>
                    </button>
                </div>

                <!-- Start Earning Button -->
                <button id="startEarningBtn" class="w-full gradient-success text-white font-bold py-4 rounded-xl text-lg mb-6 shadow-lg hover:opacity-90 transition active:scale-95 animate-pulse-slow">
                    <i class="fas fa-play mr-2"></i> Start Earning Now
                </button>

                <!-- Referral Section -->
                <div class="glass-card rounded-2xl p-6 mb-6 gradient-info text-white">
                    <h3 class="text-xl font-bold mb-3">Refer & Earn</h3>
                    <p class="text-sm opacity-90 mb-4">Invite friends and earn ৳20 for each friend who joins!</p>
                    
                    <div class="bg-white/20 rounded-xl p-4 mb-4">
                        <p class="text-sm mb-2">Your Referral Link</p>
                        <div class="flex items-center">
                            <input id="referralLink" type="text" readonly class="flex-1 bg-transparent text-white text-sm outline-none">
                            <button id="copyLinkBtn" class="ml-2 w-10 h-10 rounded-full bg-white/30 flex items-center justify-center hover:bg-white/40 transition">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <p class="text-xs opacity-75 mt-2">Copy and share your referral link with friends</p>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button id="shareBtn" class="flex-1 bg-white text-blue-600 font-semibold py-3 rounded-xl hover:bg-gray-50 transition active:scale-95">
                            <i class="fas fa-share-alt mr-2"></i> Share Now
                        </button>
                        <button id="referralStatsBtn" class="flex-1 bg-white/20 text-white font-semibold py-3 rounded-xl hover:bg-white/30 transition active:scale-95">
                            <i class="fas fa-chart-bar mr-2"></i> Stats
                        </button>
                    </div>
                </div>

                <!-- Stats Section -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="glass-card rounded-2xl p-5">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center mr-3">
                                <i class="fas fa-fire text-green-600 dark:text-green-300"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-300">Daily Streak</p>
                                <p class="text-xl font-bold text-gray-800 dark:text-white" id="dailyStreak">0 days</p>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full" style="width: 0%" id="streakProgress"></div>
                        </div>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-5">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900 flex items-center justify-center mr-3">
                                <i class="fas fa-users text-purple-600 dark:text-purple-300"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-300">Referrals</p>
                                <p class="text-xl font-bold text-gray-800 dark:text-white" id="referralCount">0 friends</p>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full" style="width: 0%" id="referralProgress"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Page -->
            <div id="tasksPage" class="page">
                <div class="flex items-center mb-6">
                    <button id="backFromTasks" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mr-3 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                        <i class="fas fa-arrow-left text-gray-600 dark:text-gray-300"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">All Tasks</h2>
                </div>
                
                <div class="glass-card rounded-2xl p-6 mb-6 gradient-primary text-white">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="text-sm opacity-90">Tasks Progress</p>
                            <p class="text-2xl font-bold" id="tasksProgress">0/0</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm opacity-90">Total Earned</p>
                            <p class="text-2xl font-bold">
                                <span class="taka-symbol text-xl">৳</span> <span id="totalEarned">0</span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4" id="allTasksList">
                    <!-- All tasks will be loaded here -->
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profilePage" class="page">
                <div class="flex items-center mb-6">
                    <button id="backFromProfile" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mr-3 hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                        <i class="fas fa-arrow-left text-gray-600 dark:text-gray-300"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">My Profile</h2>
                </div>
                
                <div class="space-y-6">
                    <!-- Profile Info Card -->
                    <div class="glass-card rounded-2xl p-6">
                        <div class="text-center mb-6">
                            <img id="userProfilePic" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" 
                                 alt="Profile" class="profile-pic rounded-full mx-auto mb-4">
                            <h3 id="userFullName" class="text-xl font-bold text-gray-800 dark:text-white">Loading...</h3>
                            <p id="userEmail" class="text-gray-600 dark:text-gray-300">Loading...</p>
                            <p id="userPhone" class="text-gray-500 dark:text-gray-400 text-sm mt-1">Loading...</p>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="text-center">
                                <p class="text-sm text-gray-500 dark:text-gray-300">Member Since</p>
                                <p id="memberSince" class="font-bold text-gray-800 dark:text-white">-</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500 dark:text-gray-300">Level</p>
                                <p id="userLevel" class="font-bold text-gray-800 dark:text-white">Beginner</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500 dark:text-gray-300">Status</p>
                                <p id="userStatus" class="font-bold text-green-600 dark:text-green-400">Active</p>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button id="editProfileBtn" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-3 rounded-xl hover:opacity-90 transition">
                                <i class="fas fa-edit mr-2"></i> Edit Profile
                            </button>
                            <button id="changePasswordBtn" class="flex-1 border-2 border-blue-600 text-blue-600 dark:text-blue-400 dark:border-blue-400 font-bold py-3 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/30 transition">
                                <i class="fas fa-key mr-2"></i> Change Password
                            </button>
                        </div>
                    </div>
                    
                    <!-- Account Statistics -->
                    <div class="glass-card rounded-2xl p-6">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Account Statistics</h3>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900 flex items-center justify-center mr-3">
                                        <i class="fas fa-coins text-blue-600 dark:text-blue-300"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white">Total Earnings</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-300">All time</p>
                                    </div>
                                </div>
                                <p class="text-xl font-bold text-green-600 dark:text-green-400">
                                    <span class="taka-symbol">৳</span><span id="totalEarnings">0</span>
                                </p>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-xl bg-green-100 dark:bg-green-900 flex items-center justify-center mr-3">
                                        <i class="fas fa-tasks text-green-600 dark:text-green-300"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white">Tasks Completed</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-300">This month</p>
                                    </div>
                                </div>
                                <p class="text-xl font-bold text-gray-800 dark:text-white" id="monthlyTasks">0</p>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-xl bg-purple-100 dark:bg-purple-900 flex items-center justify-center mr-3">
                                        <i class="fas fa-users text-purple-600 dark:text-purple-300"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white">Successful Referrals</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-300">Active referrals</p>
                                    </div>
                                </div>
                                <p class="text-xl font-bold text-gray-800 dark:text-white" id="activeReferrals">0</p>
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-xl bg-yellow-100 dark:bg-yellow-900 flex items-center justify-center mr-3">
                                        <i class="fas fa-calendar-alt text-yellow-600 dark:text-yellow-300"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white">Current Streak</p>
                                        <p class="text-sm text-gray-500 dark:text-gray-300">Daily login</p>
                                    </div>
                                </div>
                                <p class="text-xl font-bold text-gray-800 dark:text-white" id="currentStreak">0 days</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Logout Button -->
                    <button id="logoutMainBtn" class="w-full bg-gradient-to-r from-red-500 to-pink-600 text-white font-bold py-3 rounded-xl hover:opacity-90 transition">
                        <i class="fas fa-sign-out-alt mr-2"></i> Logout Account
                    </button>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav id="bottomNav" class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 py-3 px-6 hidden">
            <div class="flex justify-between items-center">
                <button class="nav-btn active" data-page="home">
                    <i class="fas fa-home text-lg mb-1"></i>
                    <span class="text-xs">Home</span>
                </button>
                
                <button class="nav-btn" data-page="tasks">
                    <i class="fas fa-tasks text-lg mb-1"></i>
                    <span class="text-xs">Tasks</span>
                </button>
                
                <button class="nav-btn" data-page="earn">
                    <div class="w-14 h-14 rounded-full gradient-primary flex items-center justify-center -mt-6 shadow-lg">
                        <i class="fas fa-bolt text-white text-xl"></i>
                    </div>
                </button>
                
                <button class="nav-btn" data-page="withdraw">
                    <i class="fas fa-wallet text-lg mb-1"></i>
                    <span class="text-xs">Withdraw</span>
                </button>
                
                <button class="nav-btn" data-page="profile">
                    <i class="fas fa-user text-lg mb-1"></i>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
        </nav>

        <!-- Notification -->
        <div id="notification" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 w-11/12 max-w-md hidden">
            <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-xl shadow-lg flex items-center">
                <i class="fas fa-check-circle text-xl mr-3"></i>
                <p id="notificationText">Notification message</p>
                <button id="closeNotification" class="ml-auto text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <!-- Ads Loading Overlay -->
        <div id="adsLoadingOverlay" class="ad-loading-overlay hidden">
            <div class="ad-step-indicator">
                <div class="ad-step completed" id="adsStep1">1</div>
                <div class="ad-step active" id="adsStep2">2</div>
                <div class="ad-step" id="adsStep3">3</div>
            </div>
            
            <div class="loader mb-4"></div>
            <h2 class="text-2xl font-bold mb-2">Loading Ads...</h2>
            <p class="text-gray-300 mb-4">Please wait while we load the advertisement</p>
            
            <div class="ad-progress-bar">
                <div class="ad-progress-fill" id="adsProgressFill"></div>
            </div>
        </div>
        
        <!-- Video Ad Loading Overlay -->
        <div id="videoAdLoadingOverlay" class="ad-loading-overlay hidden">
            <div class="video-ad-loading">
                <div class="video-icon">
                    <i class="fas fa-play-circle"></i>
                </div>
                <h2 class="video-title">Loading Video Ad</h2>
                <p class="video-subtitle">Please wait while we load the video advertisement</p>
                
                <div class="loader mb-4"></div>
                
                <div class="ad-progress-bar">
                    <div class="ad-progress-fill" id="videoProgressFill"></div>
                </div>
            </div>
        </div>
        
        <!-- Countdown Overlay -->
        <div id="countdownOverlay" class="ad-loading-overlay hidden">
            <div class="countdown-container">
                <div class="countdown-circle">
                    <div class="countdown-number" id="countdownNumber">15</div>
                </div>
                <h2 class="countdown-text">Reward is being processed</h2>
                <p class="countdown-subtext">Please wait while we verify your ad view</p>
                <p class="text-gray-300 text-sm mt-4">
                    <i class="fas fa-info-circle mr-2"></i>
                    Your reward will be added in <span id="remainingSeconds">15</span> seconds
                </p>
            </div>
        </div>
        
        <!-- Celebration Overlay -->
        <div id="celebrationOverlay" class="celebration-overlay hidden">
            <div class="celebration-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <h1 class="celebration-title">Congratulations!</h1>
            <div class="celebration-amount">
                <span class="taka-symbol text-3xl">৳</span>1 Added!
            </div>
            <p class="celebration-message">
                You have successfully watched the video ad. Your reward has been added to your balance.
            </p>
            <button id="closeCelebrationBtn" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 px-8 rounded-xl hover:opacity-90 transition active:scale-95">
                Continue Earning
            </button>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div id="profileEditModal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">Edit Profile</h3>
                <button id="closeProfileEditModal" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="profileEditForm">
                <div class="space-y-4">
                    <!-- Profile Picture Upload -->
                    <div class="text-center mb-4">
                        <div class="relative inline-block">
                            <img id="editProfilePreview" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" 
                                 alt="Profile" class="profile-pic rounded-full mx-auto mb-3">
                            <div class="file-input-container">
                                <button type="button" class="absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition">
                                    <i class="fas fa-camera"></i>
                                </button>
                                <input type="file" id="editProfilePicture" accept="image/*" class="cursor-pointer">
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Change profile picture</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name</label>
                        <input type="text" id="editFullName" required 
                               class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                               placeholder="Enter your full name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Address</label>
                        <input type="email" id="editEmail" required 
                               class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                               placeholder="Enter your email">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Phone Number</label>
                        <input type="tel" id="editPhoneNumber" 
                               class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                               placeholder="Enter phone number">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Current Password (for verification)</label>
                        <div class="relative">
                            <input type="password" id="currentPassword" 
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                   placeholder="Enter current password">
                            <button type="button" id="toggleCurrentPassword" class="absolute right-3 top-3 text-gray-500">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">New Password (optional)</label>
                        <div class="relative">
                            <input type="password" id="newPassword" 
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                   placeholder="Enter new password (leave empty to keep current)">
                            <button type="button" id="toggleNewPassword" class="absolute right-3 top-3 text-gray-500">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Leave empty if you don't want to change password</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Confirm New Password</label>
                        <div class="relative">
                            <input type="password" id="confirmNewPassword" 
                                   class="w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"
                                   placeholder="Confirm new password">
                            <button type="button" id="toggleConfirmNewPassword" class="absolute right-3 top-3 text-gray-500">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button type="submit" id="saveProfileBtn" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 rounded-xl hover:opacity-90 transition flex items-center justify-center">
                            <span>Save Changes</span>
                            <div id="saveProfileSpinner" class="loader ml-2 hidden" style="width: 20px; height: 20px;"></div>
                        </button>
                        <button type="button" id="cancelProfileEdit" class="flex-1 border-2 border-red-600 text-red-600 dark:text-red-400 dark:border-red-400 font-bold py-3 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/30 transition">
                            Cancel
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA2HUBFhHEWg4MwkJB4BVdJxUun0Gy07Ts",
            authDomain: "daily-earne-aea89.firebaseapp.com",
            databaseURL: "https://daily-earne-aea89-default-rtdb.firebaseio.com",
            projectId: "daily-earne-aea89",
            storageBucket: "daily-earne-aea89.firebasestorage.app",
            messagingSenderId: "444567470638",
            appId: "1:444567470638:web:0fa323d9f5ef6aba1155bf"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        // Global Variables
        let currentUser = null;
        let userData = null;
        let selectedProfilePicture = null;
        let countdownInterval = null;
        let countdownSeconds = 15;
        let isVideoAd = false;
        let referralCodeFromUrl = null;

        // DOM Elements
        const elements = {
            authContainer: document.getElementById('authContainer'),
            loginPage: document.getElementById('loginPage'),
            signupPage: document.getElementById('signupPage'),
            loginForm: document.getElementById('loginForm'),
            signupForm: document.getElementById('signupForm'),
            loginEmailPhone: document.getElementById('loginEmailPhone'),
            loginPassword: document.getElementById('loginPassword'),
            signupEmail: document.getElementById('signupEmail'),
            signupPassword: document.getElementById('signupPassword'),
            confirmPassword: document.getElementById('confirmPassword'),
            fullName: document.getElementById('fullName'),
            phoneNumber: document.getElementById('phoneNumber'),
            referralCodeInput: document.getElementById('referralCodeInput'),
            profilePicture: document.getElementById('profilePicture'),
            profilePreview: document.getElementById('profilePreview'),
            loginBtn: document.getElementById('loginBtn'),
            signupBtn: document.getElementById('signupBtn'),
            loginSpinner: document.getElementById('loginSpinner'),
            signupSpinner: document.getElementById('signupSpinner'),
            showSignupBtn: document.getElementById('showSignupBtn'),
            backToLogin: document.getElementById('backToLogin'),
            toggleLoginPassword: document.getElementById('toggleLoginPassword'),
            toggleSignupPassword: document.getElementById('toggleSignupPassword'),
            toggleConfirmPassword: document.getElementById('toggleConfirmPassword'),
            
            mainContainer: document.getElementById('mainContainer'),
            bottomNav: document.getElementById('bottomNav'),
            logoutBtn: document.getElementById('logoutBtn'),
            logoutMainBtn: document.getElementById('logoutMainBtn'),
            
            currentBalance: document.getElementById('currentBalance'),
            dailyStreak: document.getElementById('dailyStreak'),
            streakProgress: document.getElementById('streakProgress'),
            referralCount: document.getElementById('referralCount'),
            referralProgress: document.getElementById('referralProgress'),
            referralLink: document.getElementById('referralLink'),
            dailyAdsCounter: document.getElementById('dailyAdsCounter'),
            
            backFromTasks: document.getElementById('backFromTasks'),
            tasksProgress: document.getElementById('tasksProgress'),
            totalEarned: document.getElementById('totalEarned'),
            allTasksList: document.getElementById('allTasksList'),
            
            backFromProfile: document.getElementById('backFromProfile'),
            userProfilePic: document.getElementById('userProfilePic'),
            userFullName: document.getElementById('userFullName'),
            userEmail: document.getElementById('userEmail'),
            userPhone: document.getElementById('userPhone'),
            memberSince: document.getElementById('memberSince'),
            userLevel: document.getElementById('userLevel'),
            userStatus: document.getElementById('userStatus'),
            totalEarnings: document.getElementById('totalEarnings'),
            monthlyTasks: document.getElementById('monthlyTasks'),
            activeReferrals: document.getElementById('activeReferrals'),
            currentStreak: document.getElementById('currentStreak'),
            editProfileBtn: document.getElementById('editProfileBtn'),
            changePasswordBtn: document.getElementById('changePasswordBtn'),
            
            navBtns: document.querySelectorAll('.nav-btn'),
            
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notificationText'),
            closeNotification: document.getElementById('closeNotification'),
            
            themeToggle: document.getElementById('themeToggle'),
            pageTitle: document.getElementById('pageTitle'),
            
            adsLoadingOverlay: document.getElementById('adsLoadingOverlay'),
            adsProgressFill: document.getElementById('adsProgressFill'),
            adsStep1: document.getElementById('adsStep1'),
            adsStep2: document.getElementById('adsStep2'),
            adsStep3: document.getElementById('adsStep3'),
            
            videoAdLoadingOverlay: document.getElementById('videoAdLoadingOverlay'),
            videoProgressFill: document.getElementById('videoProgressFill'),
            
            countdownOverlay: document.getElementById('countdownOverlay'),
            countdownNumber: document.getElementById('countdownNumber'),
            remainingSeconds: document.getElementById('remainingSeconds'),
            
            celebrationOverlay: document.getElementById('celebrationOverlay'),
            closeCelebrationBtn: document.getElementById('closeCelebrationBtn'),
            
            // Profile Edit Modal Elements
            profileEditModal: document.getElementById('profileEditModal'),
            editProfilePreview: document.getElementById('editProfilePreview'),
            editProfilePicture: document.getElementById('editProfilePicture'),
            editFullName: document.getElementById('editFullName'),
            editEmail: document.getElementById('editEmail'),
            editPhoneNumber: document.getElementById('editPhoneNumber'),
            currentPassword: document.getElementById('currentPassword'),
            newPassword: document.getElementById('newPassword'),
            confirmNewPassword: document.getElementById('confirmNewPassword'),
            toggleCurrentPassword: document.getElementById('toggleCurrentPassword'),
            toggleNewPassword: document.getElementById('toggleNewPassword'),
            toggleConfirmNewPassword: document.getElementById('toggleConfirmNewPassword'),
            profileEditForm: document.getElementById('profileEditForm'),
            saveProfileBtn: document.getElementById('saveProfileBtn'),
            saveProfileSpinner: document.getElementById('saveProfileSpinner'),
            cancelProfileEdit: document.getElementById('cancelProfileEdit'),
            closeProfileEditModal: document.getElementById('closeProfileEditModal')
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setupEventListeners();
            checkForReferralInURL();
            
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                } else {
                    showAuthPages();
                }
            });
        });

        function initializeApp() {
            const savedTheme = localStorage.getItem('dailyEarningTheme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
                document.body.classList.add('dark');
                updateThemeIcon(true);
            }
        }

        function checkForReferralInURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const referralCode = urlParams.get('ref');
            
            if (referralCode) {
                referralCodeFromUrl = referralCode;
                // Store referral code in localStorage for signup
                localStorage.setItem('pendingReferralCode', referralCode);
                
                // If on login page, show notification
                if (window.location.pathname.includes('login') || window.location.pathname === '/') {
                    setTimeout(() => {
                        showNotification('You have been referred by a friend! Sign up to get started.', 'info');
                    }, 1000);
                }
            }
        }

        function setupEventListeners() {
            elements.loginForm.addEventListener('submit', handleLogin);
            elements.signupForm.addEventListener('submit', handleSignup);
            elements.showSignupBtn.addEventListener('click', () => navigateToAuthPage('signup'));
            elements.backToLogin.addEventListener('click', () => navigateToAuthPage('login'));
            elements.toggleLoginPassword.addEventListener('click', () => togglePasswordVisibility('loginPassword', elements.toggleLoginPassword));
            elements.toggleSignupPassword.addEventListener('click', () => togglePasswordVisibility('signupPassword', elements.toggleSignupPassword));
            elements.toggleConfirmPassword.addEventListener('click', () => togglePasswordVisibility('confirmPassword', elements.toggleConfirmPassword));
            elements.profilePicture.addEventListener('change', handleProfilePictureChange);
            
            elements.logoutBtn.addEventListener('click', handleLogout);
            elements.logoutMainBtn.addEventListener('click', handleLogout);
            
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            elements.closeNotification.addEventListener('click', () => {
                elements.notification.classList.add('hidden');
            });
            
            elements.navBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = this.dataset.page;
                    if (page === 'earn') {
                        navigateToPage('home');
                    } else {
                        navigateToPage(page);
                    }
                    updateNavActiveState(page === 'earn' ? 'home' : page);
                });
            });
            
            document.querySelectorAll('.quick-action').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.dataset.action;
                    handleQuickAction(action);
                });
            });
            
            document.getElementById('copyLinkBtn').addEventListener('click', copyReferralLink);
            document.getElementById('shareBtn').addEventListener('click', shareReferralLink);
            document.getElementById('startEarningBtn').addEventListener('click', () => navigateToPage('tasks'));
            document.getElementById('backFromTasks').addEventListener('click', () => navigateToPage('home'));
            document.getElementById('backFromProfile').addEventListener('click', () => navigateToPage('home'));
            
            elements.closeCelebrationBtn.addEventListener('click', closeCelebration);
            
            // Profile Edit Modal Event Listeners
            elements.editProfileBtn.addEventListener('click', openProfileEditModal);
            elements.closeProfileEditModal.addEventListener('click', closeProfileEditModal);
            elements.cancelProfileEdit.addEventListener('click', closeProfileEditModal);
            elements.profileEditForm.addEventListener('submit', handleProfileEdit);
            elements.toggleCurrentPassword.addEventListener('click', () => togglePasswordVisibility('currentPassword', elements.toggleCurrentPassword));
            elements.toggleNewPassword.addEventListener('click', () => togglePasswordVisibility('newPassword', elements.toggleNewPassword));
            elements.toggleConfirmNewPassword.addEventListener('click', () => togglePasswordVisibility('confirmNewPassword', elements.toggleConfirmNewPassword));
            elements.editProfilePicture.addEventListener('change', handleEditProfilePictureChange);
        }

        function navigateToAuthPage(page) {
            document.querySelectorAll('#authContainer .page').forEach(p => {
                p.classList.remove('active');
            });
            
            const pageElement = document.getElementById(`${page}Page`);
            if (pageElement) {
                pageElement.classList.add('active');
                
                // If going to signup page and there's a pending referral code, auto-fill it
                if (page === 'signup') {
                    const pendingReferralCode = localStorage.getItem('pendingReferralCode');
                    if (pendingReferralCode && elements.referralCodeInput) {
                        elements.referralCodeInput.value = pendingReferralCode;
                    }
                }
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const emailPhone = elements.loginEmailPhone.value.trim();
            const password = elements.loginPassword.value;
            
            if (!emailPhone || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            try {
                elements.loginSpinner.classList.remove('hidden');
                elements.loginBtn.disabled = true;
                
                let authResult;
                
                if (emailPhone.includes('@')) {
                    authResult = await auth.signInWithEmailAndPassword(emailPhone, password);
                } else {
                    showNotification('Phone login is not yet implemented. Please use email.', 'error');
                    elements.loginSpinner.classList.add('hidden');
                    elements.loginBtn.disabled = false;
                    return;
                }
                
                currentUser = authResult.user;
                await loadUserData();
                
                showNotification('Login successful! Welcome back.', 'success');
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Login failed. Please try again.';
                
                switch(error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'No account found with this email/phone.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password. Please try again.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'This account has been disabled.';
                        break;
                }
                
                showNotification(errorMessage, 'error');
            } finally {
                elements.loginSpinner.classList.add('hidden');
                elements.loginBtn.disabled = false;
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            
            const fullName = elements.fullName.value.trim();
            const email = elements.signupEmail.value.trim();
            const phone = elements.phoneNumber.value.trim();
            const password = elements.signupPassword.value;
            const confirmPassword = elements.confirmPassword.value;
            const referralCode = elements.referralCodeInput.value.trim();
            
            if (!fullName || !email || !password || !confirmPassword) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            try {
                elements.signupSpinner.classList.remove('hidden');
                elements.signupBtn.disabled = true;
                
                const authResult = await auth.createUserWithEmailAndPassword(email, password);
                currentUser = authResult.user;
                
                let profilePicUrl = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png';
                
                if (selectedProfilePicture) {
                    try {
                        profilePicUrl = await uploadProfilePicture(selectedProfilePicture, currentUser.uid);
                    } catch (uploadError) {
                        console.error('Profile picture upload failed:', uploadError);
                    }
                }
                
                // Check for referral code
                let referrerId = null;
                let usedReferralCode = null;
                
                if (referralCode) {
                    // Check if referral code is valid (format: ref_userid)
                    if (referralCode.startsWith('ref_')) {
                        const userId = referralCode.substring(4);
                        try {
                            const referrerSnapshot = await database.ref('users/' + userId).once('value');
                            if (referrerSnapshot.exists()) {
                                referrerId = userId;
                                usedReferralCode = referralCode;
                            }
                        } catch (error) {
                            console.error('Error checking referral code:', error);
                        }
                    }
                }
                
                const userData = {
                    uid: currentUser.uid,
                    fullName: fullName,
                    email: email,
                    phone: phone || '',
                    profilePicture: profilePicUrl,
                    balance: 0,
                    streak: 0,
                    referrals: 0,
                    successfulReferrals: 0,
                    totalReferralEarnings: 0,
                    tasksCompleted: 0,
                    totalEarnings: 0,
                    monthlyTasks: 0,
                    activeReferrals: 0,
                    memberSince: new Date().toISOString(),
                    level: 'Beginner',
                    status: 'Active',
                    lastLogin: new Date().toISOString(),
                    lastDailyBonus: null,
                    dailyAdsWatched: 0,
                    lastAdsDate: null,
                    videosWatched: 0,
                    lastVideoDate: null,
                    referrer: referrerId, // Store who referred this user
                    referralCode: `ref_${currentUser.uid.substring(0, 8)}` // This user's referral code
                };
                
                await database.ref('users/' + currentUser.uid).set(userData);
                
                // If user was referred, update referrer's data
                if (referrerId) {
                    await processReferralReward(referrerId, currentUser.uid, usedReferralCode);
                    
                    // Clear pending referral code from localStorage
                    localStorage.removeItem('pendingReferralCode');
                }
                
                await loadUserData();
                
                showNotification('Account created successfully! Welcome to Daily Earning.', 'success');
                
            } catch (error) {
                console.error('Signup error:', error);
                let errorMessage = 'Signup failed. Please try again.';
                
                switch(error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Email already in use. Please use a different email.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password is too weak. Please use a stronger password.';
                        break;
                }
                
                showNotification(errorMessage, 'error');
            } finally {
                elements.signupSpinner.classList.add('hidden');
                elements.signupBtn.disabled = false;
            }
        }

        async function processReferralReward(referrerId, referredUserId, referralCode) {
            try {
                const reward = 20; // ৳20 reward for successful referral
                
                // Update referrer's data
                const referrerRef = database.ref('users/' + referrerId);
                const referrerSnapshot = await referrerRef.once('value');
                const referrerData = referrerSnapshot.val();
                
                const updates = {
                    balance: (referrerData.balance || 0) + reward,
                    totalEarnings: (referrerData.totalEarnings || 0) + reward,
                    totalReferralEarnings: (referrerData.totalReferralEarnings || 0) + reward,
                    successfulReferrals: (referrerData.successfulReferrals || 0) + 1,
                    referrals: (referrerData.referrals || 0) + 1
                };
                
                await referrerRef.update(updates);
                
                // Create referral record
                const referralRecord = {
                    referrerId: referrerId,
                    referredUserId: referredUserId,
                    referralCode: referralCode,
                    reward: reward,
                    timestamp: new Date().toISOString(),
                    status: 'completed'
                };
                
                await database.ref('referrals/' + referredUserId).set(referralRecord);
                
                // Send notification to referrer
                const notificationData = {
                    type: 'referral_reward',
                    title: 'Referral Reward!',
                    message: `You earned ৳${reward} from referral! ${referralCode} used your referral link.`,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                await database.ref(`notifications/${referrerId}/${Date.now()}`).set(notificationData);
                
                console.log(`Referral reward processed: ${referrerId} earned ৳${reward} from ${referredUserId}`);
                
            } catch (error) {
                console.error('Error processing referral reward:', error);
            }
        }

        function handleProfilePictureChange(e) {
            const file = e.target.files[0];
            if (file) {
                if (!file.type.match('image.*')) {
                    showNotification('Please select an image file', 'error');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Image size should be less than 5MB', 'error');
                    return;
                }
                
                selectedProfilePicture = file;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    elements.profilePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function handleEditProfilePictureChange(e) {
            const file = e.target.files[0];
            if (file) {
                if (!file.type.match('image.*')) {
                    showNotification('Please select an image file', 'error');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Image size should be less than 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    elements.editProfilePreview.src = e.target.result;
                    selectedProfilePicture = file;
                };
                reader.readAsDataURL(file);
            }
        }

        async function uploadProfilePicture(file, userId) {
            return new Promise((resolve, reject) => {
                const storageRef = storage.ref();
                const profilePicRef = storageRef.child(`profile-pictures/${userId}/${Date.now()}_${file.name}`);
                
                const uploadTask = profilePicRef.put(file);
                
                uploadTask.on('state_changed',
                    null,
                    (error) => {
                        reject(error);
                    },
                    async () => {
                        const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                        resolve(downloadURL);
                    }
                );
            });
        }

        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const snapshot = await database.ref('users/' + currentUser.uid).once('value');
                userData = snapshot.val();
                
                if (!userData) {
                    userData = {
                        uid: currentUser.uid,
                        fullName: currentUser.displayName || 'User',
                        email: currentUser.email,
                        phone: '',
                        profilePicture: currentUser.photoURL || 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png',
                        balance: 0,
                        streak: 0,
                        referrals: 0,
                        successfulReferrals: 0,
                        totalReferralEarnings: 0,
                        tasksCompleted: 0,
                        totalEarnings: 0,
                        monthlyTasks: 0,
                        activeReferrals: 0,
                        memberSince: new Date().toISOString(),
                        level: 'Beginner',
                        status: 'Active',
                        lastLogin: new Date().toISOString(),
                        lastDailyBonus: null,
                        dailyAdsWatched: 0,
                        lastAdsDate: null,
                        videosWatched: 0,
                        lastVideoDate: null,
                        referralCode: `ref_${currentUser.uid.substring(0, 8)}`
                    };
                    
                    await database.ref('users/' + currentUser.uid).set(userData);
                } else {
                    await database.ref('users/' + currentUser.uid).update({
                        lastLogin: new Date().toISOString()
                    });
                    
                    const today = new Date().toDateString();
                    const lastAdsDate = userData.lastAdsDate ? new Date(userData.lastAdsDate).toDateString() : null;
                    const lastVideoDate = userData.lastVideoDate ? new Date(userData.lastVideoDate).toDateString() : null;
                    
                    if (lastAdsDate !== today) {
                        await database.ref('users/' + currentUser.uid).update({
                            dailyAdsWatched: 0,
                            lastAdsDate: new Date().toISOString()
                        });
                        userData.dailyAdsWatched = 0;
                        userData.lastAdsDate = new Date().toISOString();
                    }
                    
                    if (lastVideoDate !== today) {
                        await database.ref('users/' + currentUser.uid).update({
                            videosWatched: 0,
                            lastVideoDate: new Date().toISOString()
                        });
                        userData.videosWatched = 0;
                        userData.lastVideoDate = new Date().toISOString();
                    }
                }
                
                updateUserInterface();
                showMainApp();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                showNotification('Error loading user data', 'error');
            }
        }

        function updateUserInterface() {
            if (!userData) return;
            
            elements.currentBalance.textContent = userData.balance || 0;
            elements.dailyStreak.textContent = `${userData.streak || 0} days`;
            elements.streakProgress.style.width = `${Math.min((userData.streak || 0) * 10, 100)}%`;
            elements.referralCount.textContent = `${userData.successfulReferrals || 0} friends`;
            elements.referralProgress.style.width = `${Math.min((userData.successfulReferrals || 0) * 5, 100)}%`;
            
            if (elements.dailyAdsCounter) {
                elements.dailyAdsCounter.textContent = `(${userData.dailyAdsWatched || 0}/15)`;
            }
            
            elements.tasksProgress.textContent = `${userData.tasksCompleted || 0}/10`;
            elements.totalEarned.textContent = userData.totalEarnings || 0;
            
            elements.userProfilePic.src = userData.profilePicture;
            elements.userFullName.textContent = userData.fullName;
            elements.userEmail.textContent = userData.email;
            elements.userPhone.textContent = userData.phone || 'Not provided';
            
            if (userData.memberSince) {
                const date = new Date(userData.memberSince);
                elements.memberSince.textContent = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            }
            
            elements.userLevel.textContent = userData.level || 'Beginner';
            elements.userStatus.textContent = userData.status || 'Active';
            elements.totalEarnings.textContent = userData.totalEarnings || 0;
            elements.monthlyTasks.textContent = userData.monthlyTasks || 0;
            elements.activeReferrals.textContent = userData.successfulReferrals || 0;
            elements.currentStreak.textContent = `${userData.streak || 0} days`;
            
            generateUserReferralLink();
        }

        function generateUserReferralLink() {
            if (!currentUser || !userData) return;
            
            const baseUrl = window.location.origin;
            const referralCode = userData.referralCode || `ref_${currentUser.uid.substring(0, 8)}`;
            const referralLink = `${baseUrl}/?ref=${referralCode}`;
            
            if (elements.referralLink) {
                elements.referralLink.value = referralLink;
            }
        }

        async function handleLogout() {
            try {
                await auth.signOut();
                currentUser = null;
                userData = null;
                showAuthPages();
                showNotification('Logged out successfully', 'success');
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Logout failed. Please try again.', 'error');
            }
        }

        function showAuthPages() {
            elements.authContainer.classList.remove('hidden');
            elements.mainContainer.classList.add('hidden');
            elements.bottomNav.classList.add('hidden');
            elements.logoutBtn.classList.add('hidden');
            navigateToAuthPage('login');
        }

        function showMainApp() {
            elements.authContainer.classList.add('hidden');
            elements.mainContainer.classList.remove('hidden');
            elements.bottomNav.classList.remove('hidden');
            elements.logoutBtn.classList.remove('hidden');
            navigateToPage('home');
            updateNavActiveState('home');
        }

        function navigateToPage(page) {
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            
            const pageElement = document.getElementById(`${page}Page`);
            if (pageElement) {
                pageElement.classList.add('active');
                
                const pageTitles = {
                    'home': 'Earn money online',
                    'tasks': 'All Tasks',
                    'profile': 'My Profile'
                };
                
                elements.pageTitle.textContent = pageTitles[page] || 'Daily Earning';
                
                if (page === 'tasks') {
                    loadAllTasks();
                }
            }
        }

        function updateNavActiveState(page) {
            elements.navBtns.forEach(btn => {
                btn.classList.remove('active', 'tab-active');
                btn.classList.add('text-gray-500');
            });
            
            const activeBtn = document.querySelector(`[data-page="${page}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'tab-active', 'text-blue-600');
            }
        }

        function loadAllTasks() {
            if (!elements.allTasksList) return;
            
            const tasks = [
                { id: 1, title: 'Watch Short Ad', description: 'Watch a 30-second ad', reward: 10, icon: 'fa-ad', completed: userData?.tasksCompleted >= 1 },
                { id: 2, title: 'Watch Video', description: 'Watch a 1-minute video', reward: 15, icon: 'fa-play-circle', completed: userData?.tasksCompleted >= 2 },
                { id: 3, title: 'Complete Survey', description: 'Answer 5 questions', reward: 25, icon: 'fa-clipboard-check', completed: userData?.tasksCompleted >= 3 },
                { id: 4, title: 'Install App', description: 'Install & open recommended app', reward: 50, icon: 'fa-mobile-alt', completed: userData?.tasksCompleted >= 4 },
                { id: 5, title: 'Rate App', description: 'Rate our app on store', reward: 20, icon: 'fa-star', completed: userData?.tasksCompleted >= 5 },
                { id: 6, title: 'Follow Social', description: 'Follow our social media', reward: 15, icon: 'fa-thumbs-up', completed: userData?.tasksCompleted >= 6 },
                { id: 7, title: 'Daily Login', description: 'Login daily for bonus', reward: 10, icon: 'fa-calendar-check', completed: userData?.tasksCompleted >= 7 },
                { id: 8, title: 'Invite Friend', description: 'Invite a friend to join', reward: 50, icon: 'fa-user-plus', completed: userData?.tasksCompleted >= 8 }
            ];
            
            elements.allTasksList.innerHTML = '';
            elements.tasksProgress.textContent = `${userData?.tasksCompleted || 0}/${tasks.length}`;
            
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `flex items-center justify-between p-4 rounded-xl border ${task.completed ? 'bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800' : 'border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-600'} transition`;
                taskElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-xl ${task.completed ? 'bg-green-100 dark:bg-green-800' : 'bg-blue-100 dark:bg-blue-800'} flex items-center justify-center mr-3">
                            <i class="fas ${task.icon} ${task.completed ? 'text-green-600 dark:text-green-300' : 'text-blue-600 dark:text-blue-300'}"></i>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-800 dark:text-white">${task.title}</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-300">${task.description}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-green-600 dark:text-green-400">+৳${task.reward}</p>
                        <button class="all-task-complete-btn mt-2 px-3 py-1 rounded-full text-xs font-medium ${task.completed ? 'bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-default' : 'bg-blue-600 dark:bg-blue-700 text-white hover:bg-blue-700 dark:hover:bg-blue-600'}" 
                                data-id="${task.id}" ${task.completed ? 'disabled' : ''}>
                            ${task.completed ? '✓ Done' : 'Start'}
                        </button>
                    </div>
                `;
                elements.allTasksList.appendChild(taskElement);
            });
            
            document.querySelectorAll('.all-task-complete-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    if (this.disabled) return;
                    
                    const taskId = parseInt(this.dataset.id);
                    const taskReward = [10, 15, 25, 50, 20, 15, 10, 50][taskId - 1];
                    
                    try {
                        const updates = {};
                        updates['balance'] = (userData.balance || 0) + taskReward;
                        updates['tasksCompleted'] = (userData.tasksCompleted || 0) + 1;
                        updates['totalEarnings'] = (userData.totalEarnings || 0) + taskReward;
                        updates['monthlyTasks'] = (userData.monthlyTasks || 0) + 1;
                        
                        await database.ref('users/' + currentUser.uid).update(updates);
                        userData = { ...userData, ...updates };
                        updateUserInterface();
                        loadAllTasks();
                        
                        showNotification(`Task completed! +৳${taskReward} earned.`, 'success');
                        
                    } catch (error) {
                        console.error('Error completing task:', error);
                        showNotification('Error completing task. Please try again.', 'error');
                    }
                });
            });
        }

        function handleQuickAction(action) {
            if (!currentUser || !userData) {
                showNotification('Please login first!', 'error');
                return;
            }
            
            switch(action) {
                case 'watch-ads':
                    triggerAdsSequence(); 
                    break;
                case 'watch-videos':
                    triggerVideoAd();
                    break;
                case 'daily-bonus':
                    claimDailyBonus();
                    break;
                case 'invite-friends':
                    showNotification('Use the referral section below to invite friends!', 'info');
                    break;
            }
        }

        async function triggerAdsSequence() {
            isVideoAd = false;
            
            // ১. ডেইলি লিমিট চেক
            if (userData.dailyAdsWatched >= 15) {
                showNotification('আজকের লিমিট শেষ! আগামীকাল আবার ট্রাই করুন।', 'error');
                return;
            }

            // ২. লোডিং স্ক্রিন শো করা
            elements.adsLoadingOverlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            try {
                // Ads progress steps
                updateAdsProgress(1, 10);
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // ৩. ধাপ ১: Rewarded interstitial Ads
                await show_8954258().then(() => {
                    console.log('Rewarded interstitial ad completed successfully');
                    updateAdsProgress(1, 100);
                    return new Promise(resolve => setTimeout(resolve, 1000));
                }).catch(error => {
                    console.error('Rewarded interstitial ad error:', error);
                    throw new Error('Failed to show rewarded interstitial ad');
                });

                // ৪. ধাপ ২: Rewarded Popup Ads
                updateAdsProgress(2, 10);
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await show_8954258('pop').then(() => {
                    console.log('Rewarded popup ad completed successfully');
                    updateAdsProgress(2, 100);
                    return new Promise(resolve => setTimeout(resolve, 1000));
                }).catch(error => {
                    console.error('Rewarded popup ad error:', error);
                    throw new Error('Failed to show rewarded popup ad');
                });

                // ৫. ধাপ ৩: In-App Interstitial Ads
                updateAdsProgress(3, 10);
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await show_8954258({
                    type: 'inApp',
                    inAppSettings: {
                        frequency: 2,
                        capping: 0.1,
                        interval: 30,
                        timeout: 5,
                        everyPage: false
                    }
                }).then(() => {
                    console.log('In-app interstitial ad completed successfully');
                    updateAdsProgress(3, 100);
                    return new Promise(resolve => setTimeout(resolve, 1000));
                }).catch(error => {
                    console.error('In-app interstitial ad error:', error);
                    throw new Error('Failed to show in-app interstitial ad');
                });

                // ৬. লোডিং স্ক্রিন হাইড করা
                elements.adsLoadingOverlay.classList.add('hidden');
                
                // ৭. ১৫ সেকেন্ড কাউন্টডাউন শুরু করা
                startCountdown();

            } catch (error) {
                console.error("Ad Sequence Error:", error);
                showNotification('অ্যাড দেখা সম্পন্ন হয়নি। আবার চেষ্টা করুন।', 'warning');
                
                // লোডিং স্ক্রিন হাইড করা
                elements.adsLoadingOverlay.classList.add('hidden');
                document.body.style.overflow = 'auto';
                return;
            }
        }

        async function triggerVideoAd() {
            isVideoAd = true;
            
            // ১. ভিডিও ডেইলি লিমিট চেক
            const today = new Date().toDateString();
            const lastVideoDate = userData.lastVideoDate ? new Date(userData.lastVideoDate).toDateString() : null;
            
            if (lastVideoDate === today && userData.videosWatched >= 10) {
                showNotification('আজকের ভিডিও লিমিট শেষ! আগামীকাল আবার ট্রাই করুন।', 'error');
                return;
            }

            // ২. ভিডিও লোডিং স্ক্রিন শো করা
            elements.videoAdLoadingOverlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            try {
                // Progress বার আপডেট
                updateVideoProgress(10);
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // ৩. Rewarded Popup Ads শো করা
                await show_8954258('pop').then(() => {
                    console.log('Video ad completed successfully');
                    updateVideoProgress(100);
                    return new Promise(resolve => setTimeout(resolve, 1000));
                }).catch(error => {
                    console.error('Video ad error:', error);
                    throw new Error('Failed to show video ad');
                });

                // ৪. লোডিং স্ক্রিন হাইড করা
                elements.videoAdLoadingOverlay.classList.add('hidden');
                
                // ৫. ১৫ সেকেন্ড কাউন্টডাউন শুরু করা
                startCountdown();

            } catch (error) {
                console.error("Video Ad Error:", error);
                showNotification('ভিডিও অ্যাড দেখা সম্পন্ন হয়নি। আবার চেষ্টা করুন।', 'warning');
                
                // লোডিং স্ক্রিন হাইড করা
                elements.videoAdLoadingOverlay.classList.add('hidden');
                document.body.style.overflow = 'auto';
                return;
            }
        }

        function updateAdsProgress(step, progress) {
            // Update step indicators
            elements.adsStep1.classList.remove('active', 'completed');
            elements.adsStep2.classList.remove('active', 'completed');
            elements.adsStep3.classList.remove('active', 'completed');
            
            if (step >= 1) elements.adsStep1.classList.add('completed');
            if (step >= 2) elements.adsStep2.classList.add('completed');
            if (step >= 3) elements.adsStep3.classList.add('completed');
            
            if (step === 1) elements.adsStep1.classList.add('active');
            if (step === 2) elements.adsStep2.classList.add('active');
            if (step === 3) elements.adsStep3.classList.add('active');
            
            // Update progress bar
            const totalProgress = (step - 1) * 33 + progress;
            elements.adsProgressFill.style.width = `${totalProgress}%`;
        }

        function updateVideoProgress(progress) {
            elements.videoProgressFill.style.width = `${progress}%`;
        }

        function startCountdown() {
            // রিসেট কাউন্টডাউন
            countdownSeconds = 15;
            elements.countdownNumber.textContent = countdownSeconds;
            elements.remainingSeconds.textContent = countdownSeconds;
            
            // কাউন্টডাউন ওভারলে শো করা
            elements.countdownOverlay.classList.remove('hidden');
            
            // কাউন্টডাউন ইন্টারভেল শুরু
            countdownInterval = setInterval(() => {
                countdownSeconds--;
                elements.countdownNumber.textContent = countdownSeconds;
                elements.remainingSeconds.textContent = countdownSeconds;
                
                if (countdownSeconds <= 0) {
                    // কাউন্টডাউন শেষ হলে
                    clearInterval(countdownInterval);
                    endCountdown();
                }
            }, 1000);
        }

        function endCountdown() {
            // কাউন্টডাউন ওভারলে হাইড করা
            elements.countdownOverlay.classList.add('hidden');
            
            // রিওয়ার্ড প্রদান
            if (isVideoAd) {
                rewardUserAfterVideoAd();
            } else {
                rewardUserAfterAds();
            }
            
            // উদযাপন স্ক্রিন শো করা
            setTimeout(() => {
                showCelebration();
            }, 500);
        }

        async function rewardUserAfterAds() {
            const reward = 1; // রিওয়ার্ড ১ টাকা
            try {
                const updates = {};
                updates['balance'] = (userData.balance || 0) + reward;
                updates['totalEarnings'] = (userData.totalEarnings || 0) + reward;
                updates['dailyAdsWatched'] = (userData.dailyAdsWatched || 0) + 1;
                updates['lastAdsDate'] = new Date().toISOString();
                
                await database.ref('users/' + currentUser.uid).update(updates);
                
                // লোকাল ডাটা আপডেট এবং UI রিফ্রেশ
                userData = { ...userData, ...updates };
                updateUserInterface();
                
            } catch (err) {
                console.error('Reward error:', err);
                showNotification('টাকা যোগ করতে সমস্যা হয়েছে। ডেভেলপারকে জানান।', 'error');
            }
        }

        async function rewardUserAfterVideoAd() {
            const reward = 1; // রিওয়ার্ড ১ টাকা
            try {
                const updates = {};
                updates['balance'] = (userData.balance || 0) + reward;
                updates['totalEarnings'] = (userData.totalEarnings || 0) + reward;
                updates['videosWatched'] = (userData.videosWatched || 0) + 1;
                updates['lastVideoDate'] = new Date().toISOString();
                
                await database.ref('users/' + currentUser.uid).update(updates);
                
                // লোকাল ডাটা আপডেট এবং UI রিফ্রেশ
                userData = { ...userData, ...updates };
                updateUserInterface();
                
            } catch (err) {
                console.error('Video reward error:', err);
                showNotification('টাকা যোগ করতে সমস্যা হয়েছে। ডেভেলপারকে জানান।', 'error');
            }
        }

        function showCelebration() {
            // কনফেটি এফেক্ট তৈরি করা
            createConfetti();
            
            // উদযাপন ওভারলে শো করা
            elements.celebrationOverlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function createConfetti() {
            const colors = ['#F59E0B', '#10B981', '#3B82F6', '#8B5CF6', '#EF4444'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${Math.random() * 3}s`;
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = confetti.style.width;
                
                elements.celebrationOverlay.appendChild(confetti);
                
                // ৩ সেকেন্ড পর কনফেটি রিমুভ করা
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, 3000);
            }
        }

        function closeCelebration() {
            // উদযাপন ওভারলে হাইড করা
            elements.celebrationOverlay.classList.add('hidden');
            document.body.style.overflow = 'auto';
            
            // সব কনফেটি রিমুভ করা
            const confettiElements = elements.celebrationOverlay.querySelectorAll('.confetti');
            confettiElements.forEach(confetti => {
                if (confetti.parentNode) {
                    confetti.parentNode.removeChild(confetti);
                }
            });
            
            // সফল হওয়ার নোটিফিকেশন
            if (isVideoAd) {
                showNotification('ভিডিও অ্যাড দেখা সম্পন্ন হয়েছে! ৳১ আপনার ব্যালেন্সে যোগ হয়েছে।', 'success');
            } else {
                showNotification('সব অ্যাড দেখা সম্পন্ন হয়েছে! ৳১ আপনার ব্যালেন্সে যোগ হয়েছে।', 'success');
            }
        }

        async function claimDailyBonus() {
            if (!currentUser || !userData) return;
            
            const today = new Date().toDateString();
            const lastBonusDate = userData.lastDailyBonus ? new Date(userData.lastDailyBonus).toDateString() : null;
            
            if (lastBonusDate === today) {
                showNotification('আপনি আজকের Daily Bonus ইতিমধ্যে নিয়ে নিয়েছেন! আগামীকাল আবার চেষ্টা করুন।', 'error');
                return;
            }
            
            try {
                const reward = 1;
                
                const updates = {};
                updates['balance'] = (userData.balance || 0) + reward;
                updates['totalEarnings'] = (userData.totalEarnings || 0) + reward;
                updates['lastDailyBonus'] = new Date().toISOString();
                
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayString = yesterday.toDateString();
                
                if (lastBonusDate === yesterdayString) {
                    updates['streak'] = (userData.streak || 0) + 1;
                } else if (!lastBonusDate) {
                    updates['streak'] = 1;
                } else {
                    updates['streak'] = 1;
                }
                
                await database.ref('users/' + currentUser.uid).update(updates);
                userData = { ...userData, ...updates };
                updateUserInterface();
                
                showNotification(`Daily Bonus! ৳${reward} has been added to your balance. Streak: ${updates['streak']} days`, 'success');
                
            } catch (error) {
                console.error('Error claiming daily bonus:', error);
                showNotification('Error claiming daily bonus. Please try again.', 'error');
            }
        }

        async function copyReferralLink() {
            navigator.clipboard.writeText(elements.referralLink.value)
                .then(() => {
                    // শুধু লিংক কপি করা হয়েছে, ব্যালেন্স যোগ করা হবে না
                    showNotification('Referral link copied to clipboard! Share with friends to earn ৳20.', 'success');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    showNotification('Failed to copy link. Please try again.', 'error');
                });
        }

        function shareReferralLink() {
            if (navigator.share) {
                navigator.share({
                    title: 'Daily Earning - Earn Money Online',
                    text: 'Join Daily Earning and start earning money by completing simple tasks! Use my referral link to get started.',
                    url: elements.referralLink.value
                })
                .then(() => {
                    showNotification('Thanks for sharing! You will earn ৳20 when friends join using your link.', 'success');
                })
                .catch(err => console.error('Error sharing:', err));
            } else {
                copyReferralLink();
            }
        }

        // Profile Edit Modal Functions
        function openProfileEditModal() {
            if (!currentUser || !userData) return;
            
            // Populate form with current user data
            elements.editProfilePreview.src = userData.profilePicture;
            elements.editFullName.value = userData.fullName || '';
            elements.editEmail.value = userData.email || '';
            elements.editPhoneNumber.value = userData.phone || '';
            
            // Reset password fields
            elements.currentPassword.value = '';
            elements.newPassword.value = '';
            elements.confirmNewPassword.value = '';
            
            // Show modal
            elements.profileEditModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeProfileEditModal() {
            elements.profileEditModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            selectedProfilePicture = null;
        }

        async function handleProfileEdit(e) {
            e.preventDefault();
            
            const fullName = elements.editFullName.value.trim();
            const email = elements.editEmail.value.trim();
            const phone = elements.editPhoneNumber.value.trim();
            const currentPasswordValue = elements.currentPassword.value;
            const newPasswordValue = elements.newPassword.value;
            const confirmNewPasswordValue = elements.confirmNewPassword.value;
            
            if (!fullName || !email) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Verify current password
            if (!currentPasswordValue) {
                showNotification('Please enter your current password for verification', 'error');
                return;
            }
            
            try {
                // Verify current password
                const credential = firebase.auth.EmailAuthProvider.credential(currentUser.email, currentPasswordValue);
                await currentUser.reauthenticateWithCredential(credential);
                
                elements.saveProfileSpinner.classList.remove('hidden');
                elements.saveProfileBtn.disabled = true;
                
                let profilePicUrl = userData.profilePicture;
                
                // Upload new profile picture if selected
                if (selectedProfilePicture) {
                    try {
                        profilePicUrl = await uploadProfilePicture(selectedProfilePicture, currentUser.uid);
                    } catch (uploadError) {
                        console.error('Profile picture upload failed:', uploadError);
                    }
                }
                
                const updates = {
                    fullName: fullName,
                    email: email,
                    phone: phone,
                    profilePicture: profilePicUrl
                };
                
                // Update Firebase user data
                await database.ref('users/' + currentUser.uid).update(updates);
                
                // Update email if changed
                if (email !== currentUser.email) {
                    await currentUser.updateEmail(email);
                }
                
                // Update password if provided
                if (newPasswordValue) {
                    if (newPasswordValue.length < 6) {
                        showNotification('New password must be at least 6 characters', 'error');
                        elements.saveProfileSpinner.classList.add('hidden');
                        elements.saveProfileBtn.disabled = false;
                        return;
                    }
                    
                    if (newPasswordValue !== confirmNewPasswordValue) {
                        showNotification('New passwords do not match', 'error');
                        elements.saveProfileSpinner.classList.add('hidden');
                        elements.saveProfileBtn.disabled = false;
                        return;
                    }
                    
                    await currentUser.updatePassword(newPasswordValue);
                }
                
                // Reload user data
                await loadUserData();
                
                showNotification('Profile updated successfully!', 'success');
                closeProfileEditModal();
                
            } catch (error) {
                console.error('Profile update error:', error);
                let errorMessage = 'Failed to update profile. Please try again.';
                
                switch(error.code) {
                    case 'auth/wrong-password':
                        errorMessage = 'Current password is incorrect.';
                        break;
                    case 'auth/email-already-in-use':
                        errorMessage = 'Email already in use. Please use a different email.';
                        break;
                    case 'auth/requires-recent-login':
                        errorMessage = 'Please login again to change your email or password.';
                        break;
                }
                
                showNotification(errorMessage, 'error');
            } finally {
                elements.saveProfileSpinner.classList.add('hidden');
                elements.saveProfileBtn.disabled = false;
            }
        }

        function togglePasswordVisibility(passwordFieldId, toggleButton) {
            const passwordField = document.getElementById(passwordFieldId);
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            
            const icon = toggleButton.querySelector('i');
            if (type === 'text') {
                icon.className = 'fas fa-eye-slash';
            } else {
                icon.className = 'fas fa-eye';
            }
        }

        function updateThemeIcon(isDark) {
            const icon = elements.themeToggle.querySelector('i');
            
            if (isDark) {
                icon.className = 'fas fa-sun text-yellow-400';
                elements.themeToggle.title = 'Switch to light mode';
            } else {
                icon.className = 'fas fa-moon text-gray-600';
                elements.themeToggle.title = 'Switch to dark mode';
            }
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark');
            localStorage.setItem('dailyEarningTheme', isDark ? 'dark' : 'light');
            updateThemeIcon(isDark);
            showNotification(`Switched to ${isDark ? 'dark' : 'light'} mode`, 'info');
        }

        function showNotification(message, type = 'info') {
            elements.notificationText.innerHTML = message;
            
            const notificationDiv = elements.notification.querySelector('div');
            notificationDiv.className = 'text-white p-4 rounded-xl shadow-lg flex items-center notification-slide';
            
            switch(type) {
                case 'success':
                    notificationDiv.classList.add('bg-gradient-to-r', 'from-green-500', 'to-emerald-600');
                    break;
                case 'error':
                    notificationDiv.classList.add('bg-gradient-to-r', 'from-red-500', 'to-pink-600');
                    break;
                case 'warning':
                    notificationDiv.classList.add('bg-gradient-to-r', 'from-yellow-500', 'to-orange-600');
                    break;
                default:
                    notificationDiv.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-indigo-600');
            }
            
            elements.notification.classList.remove('hidden');
            
            setTimeout(() => {
                elements.notification.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
